name: APPXF Test Preparations
description: "Checkout using project and APPXF and install prerequisites"

inputs:
  os:
    type: string
    required: true
  python-version:
    type: string
    required: true
  caller-is-kiss-cf:
    type: string
    required: false
    default: 'no'
  kiss-cf-token:
    required: false

runs:
  using: "composite"

  steps:
  - name: Checkout
    uses: actions/checkout@v3

  - name: Checkout kiss_cf (if called from using project)
    uses: actions/checkout@v3
    with:
      repository: alexander-rd/kiss_cf
      path: kiss_cf
      # TODO: remove token once repo becomes bublic
      token: ${{ inputs.kiss-cf-token }}
    if: inputs.caller-is-kiss-cf == 'no'

  - name: Setup (if called kiss_cf)
    uses: ./.github/actions/setup
    with:
      python-version: ${{ inputs.python-version }}
    if: inputs.caller-is-kiss-cf != 'no'

  - name: Setup (if called from using project)
    uses: ./kiss_cf/.github/actions/setup
    with:
      python-version: ${{ inputs.python-version }}
    if: inputs.caller-is-kiss-cf == 'no'

  - name: Install kiss_cf (if called from using project)
    run: pip install -e./kiss_cf
    shell: bash
    if: inputs.caller-is-kiss-cf == 'no'

  - name: Orientation (ls)
    run: ls -la
    shell: bash
    if: runner.os == 'Linux'

  - run: pip install tox tox-gh-actions
    shell: bash

  # Test execution via tox must be executed by calling workflow. This is
  # neccesary in case secrets like passwords need to be passed to the tox
  # execution.
  - name: Tox Test Execution
    run: tox
    shell: bash
    if: inputs.caller-is-kiss-cf != 'no'
